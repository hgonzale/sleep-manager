#!/usr/bin/make -f

%:
	dh $@

override_dh_auto_build:
	:

override_dh_auto_test:
	:

override_dh_auto_install:
	# Stage application files under /usr/lib/sleep-manager
	mkdir -p debian/sleep-manager/usr/lib/sleep-manager
	rsync -a \
	  --exclude '.git' \
	  --exclude '.github' \
	  --exclude '.venv' \
	  --exclude '.vscode' \
	  --exclude 'AGENTS.md' \
	  --exclude 'build' \
	  --exclude 'config' \
	  --exclude 'docs' \
	  --exclude 'homebridge-sleep-manager' \
	  --exclude 'scripts' \
	  --exclude 'systemd' \
	  --exclude 'tests' \
	  --exclude 'tox.ini' \
	  --exclude 'uv.lock' \
	  --exclude '__pycache__' \
	  --exclude '*.pyc' \
	  --exclude 'debian' \
	  --exclude 'dist' \
	  ./ debian/sleep-manager/usr/lib/sleep-manager/

	# Sudoers
	mkdir -p debian/sleep-manager/etc/sudoers.d
	install -m 0440 debian/sleep-manager.sudoers \
	  debian/sleep-manager/etc/sudoers.d/sleep-manager

	# Config
	mkdir -p debian/sleep-manager/etc/sleep-manager
	if [ -f config/sleep-manager-config.toml.example ]; then \
	  install -m 0644 config/sleep-manager-config.toml.example \
	    debian/sleep-manager/etc/sleep-manager/sleep-manager-config.toml; \
	fi

override_dh_fixperms:
	dh_fixperms
	chmod 0440 debian/sleep-manager/etc/sudoers.d/sleep-manager
